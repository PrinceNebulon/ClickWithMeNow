<!DOCTYPE html>
<html>
<head>
<!-- BypassLoginForm/chatOrCallback.html?chatUsername={name} -->
	<script type="text/javascript" src="/cwmn/jquery-2.1.1.js"></script>
    <script type="text/javascript">
        var cwmnInstance;
        var chatWindow;
        var pubLink;

        function Setup() {
            document.getElementById("cwmnShowHomeLink").addEventListener("click", invokeShowHome, false);
            document.getElementById("cwmnShowRegisterDemoLink").addEventListener("click", invokeShowRegisterDemo, false);
            document.getElementById("cwmnShowPressReleasesLink").addEventListener("click", invokeShowPressReleases, false);

            document.getElementById("cwmnSeeHomeLink").addEventListener("click", invokeSeeHome, false);
            document.getElementById("cwmnSeeRegisterDemoLink").addEventListener("click", invokeSeeRegisterDemo, false);
            document.getElementById("cwmnSeePressReleasesLink").addEventListener("click", invokeSeePressReleases, false);

            // start chat
            document.getElementById('chatiframe').src = 'BypassLoginForm/chatOrCallback.html?chatUsername='+getParameterByName('chatUsername');

            window.loadCwmn = loadCwmn;
        }

        function loadCwmn() {
            var cwmn = new Cwmn({});
            cwmnInstance = cwmn.instance;
            cwmn.init(function() {
            	SetLink();
            	// Hide the CWMN control panel on this page. The API is not seperate from the UI.
            	$('#cwmn-panel').hide();
            });
        }

        // Show methods
        function invokeShowHome() {
        	console.debug('invokeShowHome');
        	showAnAgent('http://tim-cic4su5.dev2000.com/cwmn/index.html');
        }

        function invokeShowRegisterDemo() {
        	console.debug('invokeShowRegisterDemo');
        	showAnAgent('http://tim-cic4su5.dev2000.com/cwmn/demo2.html');
        }

        function invokeShowPressReleases() {
        	console.debug('invokeShowPressReleases');
        	showAnAgent('http://tim-cic4su5.dev2000.com/cwmn/pr.html');
        }

        // See methods
        function invokeSeeHome() {
        	console.debug('invokeSeeHome');
        	inviteAgentToHost('http://tim-cic4su5.dev2000.com/cwmn/index.html');
        }

        function invokeSeeRegisterDemo() {
        	console.debug('invokeSeeRegisterDemo');
        	inviteAgentToHost('http://tim-cic4su5.dev2000.com/cwmn/demo2.html');
        }


        function invokeSeePressReleases() {
        	console.debug('invokeSeePressReleases');
        	inviteAgentToHost('http://tim-cic4su5.dev2000.com/cwmn/pr.html');
        }

        function inviteAgentToHost(url) {
        	console.debug('sendInviteToHost');
			cwmnInstance.sessionAPI.inviteToHost({
				hostName: getParameterByName('chatUsername'),
				hostEmail: 'noreply@inin.com',
				inviteName: 'Agent',
				inviteEmail: 'noreply@inin.com',
				message: 'no message',
				url: url
			}, function(result) {
        		console.debug(JSON.stringify(result));
				sendToChat('https://ms.clickwith.me/host/' + result.screen.screenId);
				window.open(result.inviteLink);
			}, function(error) {
        		console.error(JSON.stringify(error));
			});
		}

        function showAnAgent(url) {
        	console.debug('sendInviteToHost');
			cwmnInstance.sessionAPI.inviteToHost({
				hostName: getParameterByName('chatUsername'),
				hostEmail: 'noreply@inin.com',
				inviteName: 'Agent',
				inviteEmail: 'noreply@inin.com',
				message: 'no message',
				url: url
			}, function(result) {
        		console.debug(JSON.stringify(result));
				sendToChat(result.inviteLink);
				window.open('https://ms.clickwith.me/host/' + result.screen.screenId);
			}, function(error) {
        		console.error(JSON.stringify(error));
			});
		}

		function sendToChat(message) {
			$('#chatiframe').contents().find('#inputPanel').val(message);
            setTimeout(function() { $('#chatiframe').contents().find('#sendButton').click(); }, 500);
		}

		function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }




            
        function startCwmnSession() {
            cwmnInstance.sessionAPI.initializeScreen({
                hostName: 'T-host',
                hostEmail: 'tim.smith@inin.com'
            }, function() {
                cwmnInstance.publicLink.activate();
                pubLink = cwmnInstance.publicLink.generate();
                cwmnInstance.UI.startHosting();
                SetLink();
            });
        }

        function SetLink() {
            var inSession = cwmnInstance.userData.screenId != '';
            if (!inSession) return;
			$('#chatiframe').contents().find('#inputPanel').val(pubLink);
            setTimeout(function() { $('#chatiframe').contents().find('#sendButton').click(); }, 500);
        }

        function InviteToUrl(){
        	cwmnInstance.sessionAPI.inviteToHost({
				hostName: 'Customer Host',
				hostEmail: 'noreply@clickwithmenow.com',
				inviteName: 'Agent Guest',
				inviteEmail: 'tim.smith@inin.com',
				message: 'plz join',
				url: 'http://tim-cic4su5.dev2000.com/cwmn/index.html'
			}, function(result) {
				var successNotification = d.createElement('div');
				var link = '<a href="' + result.inviteLink + '" target="_blank">' + result.inviteLink + '</a>';
				successNotification.innerHTML = 'Invite sent. Go to ' + link + ' to view the host\'s screen.';
				successNotification.className = 'alert alert-success';
				ithNotifications.appendChild(successNotification);
				console.log(result);
			}, function(error) {
				
			});
        }
</script>
    <script src="/cwmn/clickwithmenow.js"></script>
	<title>Web Chat</title>
	<style type="text/css">
		body {
			margin: 0px;
			padding: 0px;
			height: 100%;
			background-color: #FBCA48;
            font-family: "Arial","Helvetica", sans-serif;
            font-size: 10pt;
		}

		iframe {
			margin: 0px;
			padding: 0px;
			border-width: 0px;
			border-collapse: collapse;
			width: 73%;
			height: 100%;
		}

		#ButttonContainer {
			float: right;
			width: 25%;
			margin: 0px 1%;
		}

		button, input {
			width: 100%;
		}

		ul {
			margin-top: 0px;
		}

		a, a:visited {
			color: #6B0014;
		}

		a:hover {
			color: #007EA2;
		}
	</style>
</head>
<body onload="Setup()">
	<iframe id="chatiframe"></iframe>
	<div id="ButttonContainer">
		<br />
		<img src="/cwmn/images/cwmn show agent.png" /><br />
		<ul>
			<li><a href="#" id="cwmnShowHomeLink">Home page</a></li>
			<li><a href="#" id="cwmnShowRegisterDemoLink">Register for Demo</a></li>
			<li><a href="#" id="cwmnShowPressReleasesLink">Press releases</a></li>
		</ul>
		<br />
		<img src="/cwmn/images/cwmn guided tour.png" /><br />
		<ul>
			<li><a href="#" id="cwmnSeeHomeLink">Home page</a></li>
			<li><a href="#" id="cwmnSeeRegisterDemoLink">Register for Demo</a></li>
			<li><a href="#" id="cwmnSeePressReleasesLink">Press releases</a></li>
		</ul>
	</div>
</body>
</html>